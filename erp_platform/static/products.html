<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ERP管理平台 - 商品管理</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: "Microsoft YaHei", sans-serif; margin: 0; background: #f0f2f5; }
    .nav { background: #1a1a2e; color: #fff; padding: 12px 24px; }
    .nav a { color: #fff; text-decoration: none; margin-right: 16px; }
    .main { padding: 24px; max-width: 1000px; margin: 0 auto; }
    table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
    th { background: #f5f5f5; }
    .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
    .btn-primary { background: #4a9eff; color: #fff; }
    .btn-primary:hover { background: #3a8eef; }
    .filter { margin-bottom: 16px; }
    .filter input, .filter select { padding: 8px; margin-right: 8px; }
    #productList tbody tr:hover { background: #f9f9f9; }
    .msg { padding: 8px; margin-bottom: 12px; border-radius: 4px; }
    .msg.error { background: #fee; color: #c00; }
    .msg.success { background: #efe; color: #060; }
  </style>
</head>
<body>
  <nav class="nav">
    <a href="/dashboard">首页</a>
    <a href="/products">商品管理</a>
    <a href="/orders">订单管理</a>
    <a href="/logout">退出</a>
  </nav>
  <main class="main">
    <h1 id="pageTitle">商品管理</h1>
    <div class="filter">
      <label>类别筛选：</label>
      <select id="categoryFilter">
        <option value="">全部</option>
        <option value="电子产品">电子产品</option>
        <option value="文具">文具</option>
        <option value="日用品">日用品</option>
      </select>
      <button type="button" class="btn btn-primary" id="btnQuery">查询</button>
      <button type="button" class="btn btn-primary" id="addProductBtn">新增商品</button>
    </div>
    <div id="message" class="msg" style="display:none;"></div>
    <table id="productTable">
      <thead>
        <tr>
          <th>编码</th>
          <th>名称</th>
          <th>类别</th>
          <th>单价</th>
          <th>库存</th>
          <th>单位</th>
        </tr>
      </thead>
      <tbody id="productList"></tbody>
    </table>
  </main>
  <script>
    function showMsg(text, isError) {
      var el = document.getElementById('message');
      el.textContent = text;
      el.className = 'msg ' + (isError ? 'error' : 'success');
      el.style.display = 'block';
      setTimeout(function(){ el.style.display = 'none'; }, 3000);
    }
    function loadProducts() {
      var cat = document.getElementById('categoryFilter').value;
      var url = '/api/products' + (cat ? '?category=' + encodeURIComponent(cat) : '');
      fetch(url, { credentials: 'same-origin' })
        .then(function(r){ return r.json(); })
        .then(function(d){
          var tbody = document.getElementById('productList');
          tbody.innerHTML = '';
          if (!d.success) { showMsg(d.message || '加载失败', true); return; }
          (d.data || []).forEach(function(p){
            var tr = document.createElement('tr');
            tr.innerHTML = '<td>' + (p.code || '') + '</td><td>' + (p.name || '') + '</td><td>' + (p.category || '-') + '</td><td>' + (p.price != null ? p.price : '-') + '</td><td>' + (p.stock != null ? p.stock : '-') + '</td><td>' + (p.unit || '个') + '</td>';
            tbody.appendChild(tr);
          });
        })
        .catch(function(){ showMsg('网络错误', true); });
    }
    document.getElementById('btnQuery').onclick = loadProducts;
    document.getElementById('addProductBtn').onclick = function(){
      var code = prompt('商品编码：');
      if (!code) return;
      var name = prompt('商品名称：');
      if (!name) return;
      var price = prompt('单价：');
      if (price === null) return;
      fetch('/api/products', {
        method: 'POST',
        credentials: 'same-origin',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ code: code.trim(), name: name.trim(), price: price, category: '', unit: '个', stock: 0 })
      })
        .then(function(r){ return r.json(); })
        .then(function(d){ showMsg(d.message || (d.success ? '添加成功' : '失败'), !d.success); if (d.success) loadProducts(); })
        .catch(function(){ showMsg('请求失败', true); });
    };
    document.getElementById('categoryFilter').onchange = loadProducts;
    loadProducts();
  </script>
</body>
</html>
